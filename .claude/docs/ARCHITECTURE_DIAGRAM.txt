```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PARALLEL AGENT EXECUTION ARCHITECTURE                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MAIN REPOSITORY: nvidea-poc/                                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ WORKTREES/ (gitignored, temporary isolation)                          â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ agent-tldraw-*/    â”‚  â”‚ agent-django-*/    â”‚  â”‚ agent-react-*/  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                    â”‚  â”‚                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ .agent-state.json  â”‚  â”‚ .agent-state.json  â”‚  â”‚ .agent-state.  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”œâ”€â”€ samples/       â”‚  â”‚ â”œâ”€â”€ samples/       â”‚  â”‚ â”œâ”€â”€ samples/   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”‚   â””â”€â”€ task-      â”‚  â”‚ â”‚   â””â”€â”€ task-      â”‚  â”‚ â”‚   â””â”€â”€ task-  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”‚     tldraw-*     â”‚  â”‚ â”‚     django-*     â”‚  â”‚ â”‚     react-*  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€â”€ (full repo)    â”‚  â”‚ â””â”€â”€ (full repo)    â”‚  â”‚ â””â”€â”€ (full repo)â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                    â”‚  â”‚                    â”‚  â”‚                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ Agent 1 works here â”‚  â”‚ Agent 2 works here â”‚  â”‚ Agent 3 works  â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SAMPLES/ (committed, final results)                                   â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  task-1/  task-2/  task-3/  â† existing samples                        â”‚  â”‚
â”‚  â”‚  task-4/  task-5/  task-6/  â† merged from agents (sequential)        â”‚  â”‚
â”‚  â”‚     â†‘        â†‘        â†‘                                               â”‚  â”‚
â”‚  â”‚     â”‚        â”‚        â”‚                                               â”‚  â”‚
â”‚  â”‚  merged  merged   merged  (atomic with file locking)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SCRIPTS/                                                              â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  setup-agent-worktree.sh    â† Create isolated workspace              â”‚  â”‚
â”‚  â”‚  merge-samples.sh           â† Atomically merge results               â”‚  â”‚
â”‚  â”‚  cleanup-agent-worktree.sh  â† Remove worktree after done             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            WORKFLOW SEQUENCE                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PHASE 1: SETUP (Parallel)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Terminal 1                 Terminal 2                 Terminal 3
    â”‚                          â”‚                          â”‚
    â”œâ”€> setup-agent-          â”œâ”€> setup-agent-          â”œâ”€> setup-agent-
    â”‚   worktree.sh tldraw     â”‚   worktree.sh django    â”‚   worktree.sh react
    â”‚                          â”‚                          â”‚
    â”œâ”€> Creates:               â”œâ”€> Creates:               â”œâ”€> Creates:
    â”‚   â€¢ agent-tldraw-*       â”‚   â€¢ agent-django-*       â”‚   â€¢ agent-react-*
    â”‚   â€¢ branch: agent/...    â”‚   â€¢ branch: agent/...    â”‚   â€¢ branch: agent/...
    â”‚   â€¢ .agent-state.json    â”‚   â€¢ .agent-state.json    â”‚   â€¢ .agent-state.json
    â”‚                          â”‚                          â”‚
    â””â”€> cd worktrees/          â””â”€> cd worktrees/          â””â”€> cd worktrees/
        agent-tldraw-*/            agent-django-*/            agent-react-*/


PHASE 2: EXECUTION (Parallel - 60-90 min each)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Terminal 1                 Terminal 2                 Terminal 3
    â”‚                          â”‚                          â”‚
    â”œâ”€> Run task-             â”œâ”€> Run task-             â”œâ”€> Run task-
    â”‚   coordinator           â”‚   coordinator           â”‚   coordinator
    â”‚                          â”‚                          â”‚
    â”œâ”€> Detects worktree      â”œâ”€> Detects worktree      â”œâ”€> Detects worktree
    â”‚   mode automatically     â”‚   mode automatically     â”‚   mode automatically
    â”‚                          â”‚                          â”‚
    â”œâ”€> Creates:               â”œâ”€> Creates:               â”œâ”€> Creates:
    â”‚   task-tldraw-*          â”‚   task-django-*          â”‚   task-react-*
    â”‚                          â”‚                          â”‚
    â”œâ”€> Phases 1-5:            â”œâ”€> Phases 1-5:            â”œâ”€> Phases 1-5:
    â”‚   â€¢ Analyze repo         â”‚   â€¢ Analyze repo         â”‚   â€¢ Analyze repo
    â”‚   â€¢ Extract patches      â”‚   â€¢ Extract patches      â”‚   â€¢ Extract patches
    â”‚   â€¢ Generate trajectory  â”‚   â€¢ Generate trajectory  â”‚   â€¢ Generate trajectory
    â”‚   â€¢ Build Docker         â”‚   â€¢ Build Docker         â”‚   â€¢ Build Docker
    â”‚   â€¢ Validate sample      â”‚   â€¢ Validate sample      â”‚   â€¢ Validate sample
    â”‚                          â”‚                          â”‚
    â””â”€> Sample ready in        â””â”€> Sample ready in        â””â”€> Sample ready in
        worktree/samples/          worktree/samples/          worktree/samples/


PHASE 3: MERGE (Sequential with locking)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

From Main Repo
    â”‚
    â”œâ”€> merge-samples.sh agent-tldraw-*
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚ ğŸ”’ Acquire lock                 â”‚
    â”‚   â”‚ Count samples: 3                â”‚
    â”‚   â”‚ Create: samples/task-4/         â”‚
    â”‚   â”‚ Copy from worktree              â”‚
    â”‚   â”‚ Update metadata                 â”‚
    â”‚   â”‚ ğŸ”“ Release lock                 â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€> merge-samples.sh agent-django-*
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   â”‚ ğŸ”’ Acquire lock (waits if busy) â”‚
    â”‚   â”‚ Count samples: 4                â”‚
    â”‚   â”‚ Create: samples/task-5/         â”‚
    â”‚   â”‚ Copy from worktree              â”‚
    â”‚   â”‚ Update metadata                 â”‚
    â”‚   â”‚ ğŸ”“ Release lock                 â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€> merge-samples.sh agent-react-*
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ğŸ”’ Acquire lock (waits if busy) â”‚
        â”‚ Count samples: 5                â”‚
        â”‚ Create: samples/task-6/         â”‚
        â”‚ Copy from worktree              â”‚
        â”‚ Update metadata                 â”‚
        â”‚ ğŸ”“ Release lock                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PHASE 4: VALIDATE & COMMIT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    â”œâ”€> cd samples/task-4 && ./run.sh
    â”œâ”€> cd samples/task-5 && ./run.sh
    â”œâ”€> cd samples/task-6 && ./run.sh
    â”‚
    â”œâ”€> git add samples/
    â””â”€> git commit -m "Add samples from parallel run"


PHASE 5: CLEANUP
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    â”œâ”€> cleanup-agent-worktree.sh agent-tldraw-*
    â”œâ”€> cleanup-agent-worktree.sh agent-django-*
    â””â”€> cleanup-agent-worktree.sh agent-react-*


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CONFLICT PREVENTION                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ISSUE 1: Task Number Collisions
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ WITHOUT SOLUTION:
   Agent 1: count=3 â†’ task-4
   Agent 2: count=3 â†’ task-4  â† COLLISION!
   Agent 3: count=3 â†’ task-4  â† COLLISION!

âœ… WITH SOLUTION:
   Agent 1: task-tldraw-1701234567   (in worktree)
   Agent 2: task-django-1701234568   (in worktree)
   Agent 3: task-react-1701234569    (in worktree)
   
   Merge 1: lock â†’ count=3 â†’ task-4 â†’ unlock
   Merge 2: lock â†’ count=4 â†’ task-5 â†’ unlock
   Merge 3: lock â†’ count=5 â†’ task-6 â†’ unlock


ISSUE 2: Docker Image Conflicts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ WITHOUT SOLUTION:
   All agents: docker build -t bug-fix-sample .
   â†’ Name collision, images overwrite each other

âœ… WITH SOLUTION:
   Agent 1: nvidea-poc-tldraw-task-tldraw-1701234567
   Agent 2: nvidea-poc-django-task-django-1701234568
   Agent 3: nvidea-poc-react-task-react-1701234569
   â†’ Unique images, no conflicts


ISSUE 3: File System Conflicts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ WITHOUT SOLUTION:
   All agents write to: samples/task-4/
   â†’ Files overwritten, data loss

âœ… WITH SOLUTION:
   Agent 1: worktrees/agent-tldraw-*/samples/
   Agent 2: worktrees/agent-django-*/samples/
   Agent 3: worktrees/agent-react-*/samples/
   â†’ Completely isolated


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         KEY IMPLEMENTATION DETAILS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. WORKTREE DETECTION
   â€¢ Check for .agent-state.json in repo root
   â€¢ If exists â†’ worktree mode
   â€¢ If not â†’ single mode (backward compatible)

2. UNIQUE IDENTIFIERS
   â€¢ Agent ID: agent-{repo}-{timestamp}-{random6}
   â€¢ Task ID: task-{repo}-{timestamp}
   â€¢ Docker: nvidea-poc-{repo}-{task-id}

3. ATOMIC MERGING
   â€¢ Uses flock(1) for file locking
   â€¢ Timeout: 60 seconds
   â€¢ Fallback if flock unavailable

4. GIT BRANCHES
   â€¢ One branch per agent: agent/{agent-id}
   â€¢ Deleted after cleanup
   â€¢ No impact on main branch

5. STATE TRACKING
   â€¢ .agent-state.json stores agent metadata
   â€¢ Updated during merge to "merged" status
   â€¢ Includes merged_as (final task number)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            SAFETY GUARANTEES                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… No race conditions      â†’ File locking ensures atomicity
âœ… No data loss            â†’ Each agent isolated in worktree
âœ… No overwrites           â†’ Unique IDs prevent collisions
âœ… No git conflicts        â†’ Separate branches per agent
âœ… Sequential numbering    â†’ Atomic merge preserves order
âœ… Backward compatible     â†’ Single mode still works
âœ… Cleanup-friendly        â†’ Simple script removes worktrees
âœ… Resume-capable          â†’ Failed agents can be rerun
```

